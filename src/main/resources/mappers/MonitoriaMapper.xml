<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="dao.mybatis.mappers.MonitoriaMapper">
      <resultMap type='Asignatura' id='AsignaturaResult'>
         <id property='id' column='id_Asignatura'/>
         <result property='nombre' column='nombe_Asig'/>
         <collection property='temas' ofType='Tema' resultMap='temaResult'></collection>
         <collection propery='grupos'ofType='Grupo' reslutMap='grupoResultt'></collection>
     </resultMap>
     <resultMap type='Grupo' id='grupoResult'>
        <id property='numero' column='numero'/>
        <collection propery='franjas'ofType='Franja' reslutMap='franjaResultt'></collection>
     </resultMap>
     <resultMap type='Monitor' id='monitorResult'>
         <id property='id' column='id_Carnet'/>
         <result property='nombre' column='nombre_Moni'/>
         <result property='apellido' column='apellido_Moni'/>
         <result property='ingreso' column='semestre_ingreso'/>
         <result property='telefono' column='telefono'/>
         <result property='carrera' column='carrera'/>
         <collection propery='franjas'ofType='Franja' reslutMap='franjaResultt'></collection>
     </resultMap>
      <resultMap type='Franja' id='franjaResult'>
        <id property='id' column='id_Franja_Horario'/>
        <result property='dia' column='dia' />
        <result property='inicio' column='inicio' />
        <result property='fin' column='fin' />
         <collection propery='monitorias'ofType='Monitoria' reslutMap='monitoriaResultt'></collection>
     </resultMap>
     <resultMap type='Tema' id='temaResult'>
         <id property='id' column='TemaID'/>
         <result property='name' column='name'/>
     </resultMap>
    <resultMap type= 'Monitoria' id='monitoriaResult'>
        <id property='id' column='id_Mon'/>
        <result property='ip' column='ip' />
        <result property='observaciones' column='observaciones' />
        <result property='fecha' column='fecha'/>
        <result property='grupo' column='grupo'/>
     </resultMap>
     <select parameterType='map' id='ConsultarMonitoria' resultMap='monitoriaResult'>
        select id_Monitoria, ip,observaciones,Monitoria.fecha,fecha,id_carnet,TemaID,nombre_Asig,numero,nombre_Moni
        from Monitoria,Asistencia,Tema,Monitor,Franja_Horario,Grupo,Asignatura
        where id_monitoria=#{idmo} and id_Carnet=Estudiante_id_Carnet and Monitoria_id_Monitoria=id_Monitoria and TemaID=Tema_TemaID and Franja_id=id_franja and id_carnet=Monitor_id_Carnet and Tema.Asignatura_id_Asignatura = id_Asignatura and numero = Grupo_numero and Grupo.Asignatura_id_Asignatura =  Grupo_Asignatura_id_Asignatura
     </select> 
     <insert id='agregarMonitoria'>
         insert into Monitoria(ip,observaciones,Fanja_id,fecha,id_carnet,grupo)
         values(#{ip},#{obsv},13,#{fec},#{id},#{profe},#{estu},#{grup})
         insert into Asistencia 
         values(SELECT max(id_Mon) FROM monitoria,#{tem})
     </insert>
 </mapper>
